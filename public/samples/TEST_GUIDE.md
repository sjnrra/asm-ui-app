# 依存関係マクロ解析テストガイド

このサンプルコードは、依存関係にあるマクロ命令や定数が正しく解析・展開されるかを確認するためのものです。

## テスト項目

### 1. COPY文によるファイル読み込み
- `COPY REGS` - レジスタEQU定義を読み込む
- `COPY CONSTANTS` - 定数定義を読み込む  
- `COPY MACROS` - マクロ定義を読み込む

### 2. マクロ定義の解析
以下のマクロが `MACROS.MAC` から読み込まれ、定義されることを確認：
- `SAVEREGS` - レジスタ保存マクロ
- `RESTOREREGS` - レジスタ復元マクロ
- `LOADCONST` - 定数ロードマクロ（パラメータ: &REG, &VALUE）
- `STOREREG` - レジスタストアマクロ（パラメータ: &REG, &LOC）

### 3. マクロ展開の確認
- `SAVEREGS` の呼び出しでマクロが展開される
- `LOADCONST R1,MAXLEN` でパラメータが正しく置換される
- `STOREREG R1,BUFFERLEN` でパラメータが正しく置換される
- `RESTOREREGS` の呼び出しでマクロが展開される

### 4. 定数の解決確認
- `MAXLEN` (80) が `CONSTANTS.INC` から解決される
- `BUFSIZE` (4096) が `CONSTANTS.INC` から解決される
- `RETCODE` (0) が `CONSTANTS.INC` から解決される
- `ERRCODE` (8) が `CONSTANTS.INC` から解決される
- `FLAGON` (X'80') が `CONSTANTS.INC` から解決される
- `FLAGOFF` (X'00') が `CONSTANTS.INC` から解決される

### 5. レジスタEQUの解決確認
- `R1` から `R9` が `REGS.INC` から解決される
- レジスタが正しくシンボルテーブルに登録される

## 確認方法

1. アプリを起動し、サンプルコードがメインエディタに表示されることを確認
2. 右側のパネルで以下を確認：
   - **シンボルテーブル（LabelPanel）**: 
     - REGS.INC からのレジスタ定義（R0-R9, RA-RF）が表示される
     - CONSTANTS.INC からの定数定義（ZERO, ONE, MAXLEN など）が表示される
   - **ハイライト表示**: 
     - COPY文が正しく処理されている
     - マクロ呼び出しが展開されている（展開後のコードが表示される）
   - **命令情報パネル**: 
     - マクロ呼び出し行をクリックすると、マクロ名が表示される
3. コンソールログで以下を確認：
   - 「依存ファイル "REGS.INC" を自動読み込みしました」
   - 「依存ファイル "CONSTANTS.INC" を自動読み込みしました」
   - 「依存ファイル "MACROS.MAC" を自動読み込みしました」
   - Parse result にマクロ数が表示される（例：`macrosCount: 4`）

## 期待される結果

- ✅ すべてのCOPY文が正しく処理される
- ✅ マクロ定義が正しく認識される（マクロ数: 4）
- ✅ マクロ呼び出しが正しく展開される
- ✅ パラメータが正しく置換される（例：&REG → R1, &VALUE → MAXLEN）
- ✅ 定数が正しく解決される（例：MAXLEN → 80）
- ✅ レジスタEQUが正しく解決される
- ✅ シンボルテーブルにすべてのシンボルが登録される

## トラブルシューティング

### マクロが展開されない場合
- `dependencies.json` に `MACROS.MAC` が含まれているか確認
- ブラウザのコンソールでエラーメッセージを確認

### 定数が解決されない場合
- `dependencies.json` に `CONSTANTS.INC` が含まれているか確認
- COPY文のファイル名が正しいか確認（拡張子は自動検索されます）

### レジスタが解決されない場合
- `dependencies.json` に `REGS.INC` が含まれているか確認
- ファイルが正しく `public/dependencies/` に配置されているか確認
